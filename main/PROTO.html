<html>
<head>
<title>The OpenXMLD Proposed Communication Protocol</title>
</head>	
<body>
<pre><xmp>
                 The OpenXMLD Communication Protocol
		 -----------------------------------
Date: May the 7th 2004

Author(s): 
Khalid Al-Kary

Revision: 1.0
-------------------------------------------------------------------------------

Introduction:
-------------
This document describes the way in which an OpenXMLD database server is expected
to behave towards client connections, eventually it describes the way in which 
a client should connect and work with a running OpenXMLD daemon.

Connection Establishment:
-------------------------
Obviously a client can establish a connection with an OpenXMLD daemon by connecting
to one of its listener sockets (specified in the xmld.conf file).

Header Format:
--------------
All the messages sent/received have a <header> message sent before them whose
maximum length is 35 characters  And it has the following format:

message-length <numeric value>
status <boolean>

* message-length: The length of the message following the header.

* status: 0 or 1, failure and success respectively. (always 1 for client-sent
messages)

Note: All messages are NUL-terminated, and all length values mentioned in 
this protocol include the NUL character.

Session Initialization:
-----------------------
After establishing the connection the client must wait for a message that 
has the following form:

<header>

col-sep <character>
col-sep-enc <string>
row-sep <character>
row-sep-enc <string>

* col-sep: The character which the server is going to use for 
separation of columns.

* col-sep-enc: The string to which an occurence of a column sep-
arator character is to be encoded if it was located inside a column value.

* row-sep: The character which the server is going to use for 
separation of rows.

* row-sep-enc: The string to which an occurence of a row separator character
is to be encoded if it was located inside a column value.

Authentication:
---------------
After reciving the initialization message the client must begin the 
authentication sequence by sending the following message:


<header>

user-name <string>

* user-name: The name of the connecting user.

Note: The additional new line between <header> and the message in this document
doesn't mean an actual additional '\n' but means two separate socket messages,
(i.e two write/send/... system calls for C programms). <header> in the first 
message and the rest in the second one.


After sending the user name, the client must wait until the server sends a 
header with a 0 value of message-length. If status equaled 0 the client should
restart the authentication sequence by sending the user name message again
or send a disconnection message (described later). If status is 1 the client
continues by sending the following message:

<header>

pass <string>

* pass: The password of the connecting user.

The server responds to this message with a message like the one sent after
the user name message, and the client has to respond to it exactly the same
way.

Query:
------
After the authentication sequence the client is free to query the server:

<header>

<query>

The server responds with a record set for queries that pull information out
of the server:

message-length <whatever>
status 1

col1	;

In case of failure:

message-length <whatever>
status 0

ERR <numeric value>
MSG <error message>

For queries that don't pull data out of the server a status 1 message or a status 0
plus an ERR and MSG message are sent in case of success or failure
respectively.

Disconnection:
--------------
To disconnect from the server, the client sends this message:

<header>

DISCONNECT

Note: Only upper-case DISCONNECT works.

It's safe for the client to shutdown its connected socket after sending the disconnection
message. The server also shutdowns its connected socket once this message is receieved.
</xmp></pre>
</body>
</html>
